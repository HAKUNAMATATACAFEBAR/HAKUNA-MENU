<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hakuna Matata | Menú Experiencia</title>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@500;700&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        :root { --orange: #ff8c00; --bg: #0a0a0a; --card: #161616; --text: #ffffff; --gray: #999999; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Montserrat', sans-serif; margin: 0; min-height: 100vh; background-image: radial-gradient(circle at top, #1a1a1a 0%, #0a0a0a 100%); }
        header { text-align: center; padding: 40px 20px; background: rgba(0,0,0,0.8); border-bottom: 1px solid rgba(255, 140, 0, 0.3); backdrop-filter: blur(10px); }
        .logo { font-family: 'Oswald', sans-serif; font-size: 2.5rem; color: var(--orange); letter-spacing: 4px; margin: 0; text-transform: uppercase; }
        .container { max-width: 700px; margin: auto; padding: 20px; }
        .cat-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .cat-card { background: var(--card); border: 1px solid rgba(255,255,255,0.05); padding: 25px 10px; text-align: center; border-radius: 16px; cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center; }
        .cat-card h3 { margin: 0; font-family: 'Oswald'; color: var(--orange); font-size: 0.85rem; text-transform: uppercase; }
        #view-products { display: none; }
        .back-nav { color: var(--orange); cursor: pointer; font-size: 0.8rem; text-transform: uppercase; margin-bottom: 20px; display: inline-block; font-weight: bold; }
        .product-item { background: rgba(255,255,255,0.03); margin-bottom: 12px; padding: 20px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.05); }
        .p-main-row { display: flex; justify-content: space-between; align-items: baseline; gap: 10px; }
        .p-name { font-family: 'Oswald'; color: var(--orange); font-size: 1.1rem; text-transform: uppercase; }
        .p-price { font-family: 'Oswald'; font-weight: 700; color: #fff; white-space: nowrap; }
        .p-desc-view { font-size: 0.85rem; color: var(--gray); margin-top: 5px; line-height: 1.4; }
        .admin-input { background: #000; border: 1px solid var(--orange); color: #fff; padding: 10px; width: 100%; margin-bottom: 5px; border-radius: 5px; box-sizing: border-box; }
        .admin-btn { background: transparent; border: 1px solid #444; color: #666; padding: 5px 15px; border-radius: 20px; cursor: pointer; font-size: 0.6rem; margin-top: 10px; }
        #loading-msg { text-align: center; color: var(--orange); padding: 20px; font-family: 'Oswald'; }
        .service-note { text-align: center; color: var(--gray); font-size: 0.7rem; margin-top: 30px; letter-spacing: 1px; }
    </style>
</head>
<body>

<header>
    <h1 class="logo">HAKUNA MATATA</h1>
    <p style="font-size: 0.7rem; letter-spacing: 4px; color: var(--gray);">GASTROBAR</p>
    <button class="admin-btn" onclick="authAdmin()">PANEL DE CONTROL</button>
    <button class="admin-btn" onclick="location.reload()" style="margin-left:10px;">RECARGAR</button>
</header>

<div class="container">
    <div id="loading-msg">CARGANDO MENÚ...</div>
    <div id="view-categories" class="cat-grid" style="display:none;"></div>
    <div id="view-products">
        <span class="back-nav" onclick="showHome()">← Volver</span>
        <h2 id="cat-title" style="font-family:'Oswald'; border-left: 4px solid var(--orange); padding-left:15px; text-transform:uppercase; color: white;"></h2>
        <div id="product-list"></div>
        <button id="add-item-btn" style="display:none; width:100%; padding:15px; background:var(--orange); border:none; border-radius:10px; font-weight:700; cursor:pointer; margin-top: 20px;" onclick="addNew()">+ AGREGAR PRODUCTO</button>
    </div>
    <div class="service-note">EL 10% DE SERVICIO ES OPCIONAL</div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBt3JfX5HREq8s8d8UDH1096OSrH8jx0EM",
        authDomain: "menu-hakuna.firebaseapp.com",
        databaseURL: "https://menu-hakuna-default-rtdb.firebaseio.com",
        projectId: "menu-hakuna",
        storageBucket: "menu-hakuna.firebasestorage.app",
        messagingSenderId: "859568903312",
        appId: "1:859568903312:web:e8347a7baba42c4d60f415"
    };
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const P = "Juano0709+";
    let isAdmin = false;
    let activeCat = "";
    let menu = {};

    db.ref('/').on('value', (snapshot) => {
        const data = snapshot.val();
        if (data) {
            menu = data;
            document.getElementById('loading-msg').style.display = 'none';
            if (document.getElementById('view-products').style.display !== 'block') {
                document.getElementById('view-categories').style.display = 'grid';
            }
            loadCats();
            if (activeCat) renderItems();
        }
    });

    function save() {
        db.ref('/').set(menu);
    }

    function loadCats() {
        const c = document.getElementById('view-categories');
        c.innerHTML = "";
        Object.keys(menu).forEach(cat => {
            const div = document.createElement('div');
            div.className = 'cat-card';
            // Ajuste para ocultar "01 ", "02 ", etc.
            const displayTitle = (cat.charAt(0) >= '0' && cat.charAt(0) <= '9') ? cat.substring(3) : cat;
            div.innerHTML = `<h3>${displayTitle}</h3>`;
            div.onclick = () => showCat(cat);
            c.appendChild(div);
        });
    }

    function showCat(cat) {
        activeCat = cat;
        document.getElementById('view-categories').style.display = 'none';
        document.getElementById('view-products').style.display = 'block';
        const displayTitle = (cat.charAt(0) >= '0' && cat.charAt(0) <= '9') ? cat.substring(3) : cat;
        document.getElementById('cat-title').innerText = displayTitle;
        renderItems();
        window.scrollTo(0,0);
    }

    function renderItems() {
        const l = document.getElementById('product-list');
        l.innerHTML = "";
        if (!menu[activeCat] || !menu[activeCat].items) return;

        menu[activeCat].items.forEach((item, i) => {
            const d = document.createElement('div');
            d.className = 'product-item';
            if(isAdmin) {
                d.innerHTML = `
                    <input class="admin-input" value="${item.n}" onchange="edit(${i},'n',this.value)">
                    <input class="admin-input" value="${item.p}" onchange="edit(${i},'p',this.value)">
                    <textarea class="admin-input" onchange="edit(${i},'d',this.value)">${item.d}</textarea>
                    <button onclick="remove(${i})" style="color:red; background:none; border:none; cursor:pointer; font-size:10px;">[BORRAR]</button>`;
            } else {
                d.innerHTML = `
                    <div class="p-main-row"><span class="p-name">${item.n}</span><span class="p-price">$${item.p}</span></div>
                    ${item.d ? `<div class="p-desc-view">${item.d}</div>` : ''}`;
            }
            l.appendChild(d);
        });
        document.getElementById('add-item-btn').style.display = isAdmin ? 'block' : 'none';
    }

    function showHome() {
        document.getElementById('view-categories').style.display = 'grid';
        document.getElementById('view-products').style.display = 'none';
    }

    function authAdmin() {
        if(prompt("Clave:") === P) { 
            isAdmin = true; 
            alert("Modo Administrador activado");
            loadCats(); 
            if(activeCat) renderItems(); 
        }
    }

    function edit(i, f, v) { 
        menu[activeCat].items[i][f] = v; 
        save(); 
    }

    function addNew() { 
        if (!menu[activeCat].items) menu[activeCat].items = [];
        menu[activeCat].items.push({n: "NUEVO PRODUCTO", p: "0", d: ""}); 
        save(); 
        renderItems(); 
    }

    function remove(i) { 
        if(confirm("¿Eliminar este producto?")) { 
            menu[activeCat].items.splice(i, 1); 
            save(); 
            renderItems(); 
        } 
    }
</script>
</body>
</html>
